package com.dpn.ciqqlc.service;

import java.util.ArrayList;
import java.util.List;

import org.apache.ibatis.session.SqlSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.dpn.ciqqlc.service.dto.WarningDto;
import com.dpn.ciqqlc.standard.model.WarningEventDto;
import com.dpn.ciqqlc.standard.model.WarningStandardEventDto;
import com.dpn.ciqqlc.standard.service.WarningEventService;

@Repository("warningEventService")
@Transactional
public class WarningEventServiceImpl implements WarningEventService{
	
	@Autowired
	@Qualifier("blankSST")
	private SqlSession sqlSession;
	
	@Override
	public String updateEvent(WarningDto dto) {
		//生成批次号,根据日期
		try {
			//批量插入event表
			sqlSession.insert("SQL.WARNING_EVENT.insertEvents", dto.getEventDtoList());
			//计算需要写入不符合规范表的数据
			List<WarningStandardEventDto> standardList = calculateStandard(dto);
			
			List<WarningStandardEventDto> dtos = new ArrayList<WarningStandardEventDto>();
			
			//写入规范执法记录(记录未规范执法内容)
			if (dtos != null && dtos.size() != 0) {
				insertStandardEvents(dtos);
			}
			return "success";
		} catch (Exception e) {
			e.printStackTrace();
			return "fail";
		}
	}
	
	@Override
	public String insertStandardEvents(List<WarningStandardEventDto> dtos) {
		//生成批次号,根据日期
		sqlSession.insert("insertEvents", dtos);
		
		
		return null;
	}
	
	
	//判断环节类型
	@Override
	public List<WarningStandardEventDto> calculateStandard(WarningDto dto) {
		try {
			WarningEventDto warningEvent = new WarningEventDto();
			warningEvent.setBusinessType(dto.getEventDtoList().get(0).getBusinessType());
			warningEvent.setWarningId(dto.getEventDtoList().get(0).getWarningId());
			//一般处罚
			if (dto.getEventDtoList().get(0).getBusinessType().equalsIgnoreCase("ql1100000")) {
				//查询当前所有该数据的操作记录
				List<WarningEventDto> warningEventList = sqlSession.selectList("SQL.WARNING_EVENT.selectEventByIdAndBusinessType", warningEvent);
				//比较数据，需写入Standard
				
				
			}
			return null;
		} catch (Exception e) {
			e.printStackTrace();
			return null;
			// TODO: handle exception
		}
		
	}
	
	
	
}
