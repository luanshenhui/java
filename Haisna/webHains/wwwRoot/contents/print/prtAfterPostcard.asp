<%@ LANGUAGE="VBScript" %>
<%
'-------------------------------------------------------------------------------
'   受診対象者名簿 (Ver0.0.1)
'   AUTHER  :
'-------------------------------------------------------------------------------
'       管理番号：SL-UI-Y0101-201
'       修正日  ：2010.05.11
'       担当者  ：ASC)武藤
'       修正内容：Report DesignerをCo Reportsに変更
'-------------------------------------------------------------------------------
Option Explicit
%>
<!-- #include virtual = "/webHains/includes/checkSession.inc"         -->
<!-- #include virtual = "/webHains/includes/common.inc"               -->
<!-- #include virtual = "/webHains/includes/editMessage.inc"          -->
<!-- #include virtual = "/webHains/includes/editNumberList.inc"       -->
<!-- #include virtual = "/webHains/includes/print.inc"                -->
<!-- #include virtual = "/webHains/includes/tokyu_editCourseList.inc" -->
<%
'セッション・権限チェック
Call CheckSession(BUSINESSCD_PRINT, CHECKSESSION_BUSINESS_TOP)

'-------------------------------------------------------------------------------
' 共通宣言部
'-------------------------------------------------------------------------------
Dim strMode         '印刷モード
Dim vntMessage      '通知メッセージ
Dim strURL          'URL
'-------------------------------------------------------------------------------
' 固有宣言部（各帳票に応じてこのセクションに変数を定義して下さい）
'-------------------------------------------------------------------------------
'COMオブジェクト
Dim objCommon           '共通クラス
Dim objOrganization     '団体情報アクセス用
Dim objOrgBsd           '事業部情報アクセス用
Dim objOrgRoom          '室部情報アクセス用
Dim objOrgPost          '所属情報アクセス用
Dim objPerson           '個人情報アクセス用

'引数値
Dim strSCslYear, strSCslMonth, strSCslDay       '開始年月日
Dim strECslYear, strECslMonth, strECslDay       '終了年月日
Dim YstrSCslYear, YstrSCslMonth, YstrSCslDay    '予約開始年月日
Dim YstrECslYear, YstrECslMonth, YstrECslDay    '予約終了年月日

Dim strCsCd                                 'コースコード
Dim strOrgCd1, strOrgCd2                    '団体コード
Dim strNotes                                'コメント
Dim strOrgBsdCd, strOrgRoomCd               '事業部コード, 室部コード
Dim strSOrgPostCd, strEOrgPostCd            '開始所属コード, 終了所属コード
Dim strPerId                                '個人コード
Dim strObject                               '出力対象
Dim UID

'作業用変数
Dim strOrgName          '団体名
Dim strBsdName          '事業部名
Dim strRoomName         '室部名
Dim strSPostName        '開始所属名
Dim strEPostName        '終了所属名
Dim strLastName         '姓
Dim strFirstName        '名
Dim strPerName          '氏名
Dim strSCslDate         '開始日
Dim strECslDate         '終了日

Dim YstrSCslDate        '予約開始日
Dim YstrECslDate        '予約終了日
Dim WYstrSCslDate       '予約開始日
Dim WYstrECslDate       '予約終了日
Dim WstrSCslDate        '開始日
Dim WstrECslDate        '終了日

'-------------------------------------------------------------------------------
' 先頭制御部
'-------------------------------------------------------------------------------
Set objCommon       = Server.CreateObject("HainsCommon.Common")
Set objOrganization = Server.CreateObject("HainsOrganization.Organization")
Set objOrgBsd       = Server.CreateObject("HainsOrgBsd.OrgBsd")
Set objOrgRoom      = Server.CreateObject("HainsOrgRoom.OrgRoom")
Set objOrgPost      = Server.CreateObject("HainsOrgPost.OrgPost")
Set objPerson       = Server.CreateObject("HainsPerson.Person")

'共通引数値の取得
strMode = Request("mode")

'帳票出力処理制御
vntMessage = PrintControl(strMode)

'-------------------------------------------------------------------------------
'
' 機能　　 : URL引数値の取得
'
' 引数　　 :
'
' 戻り値　 :
'
' 備考　　 : URLの引数値を取得する処理を記述して下さい
'
'-------------------------------------------------------------------------------
Sub GetQueryString()

'◆ 開始年月日
    If IsEmpty(Request("strCslYear")) Then
        WstrSCslDate = DateAdd("M", -9, Now)
        strSCslYear     = Mid(WstrSCslDate, 1, 4)   '開始年
        strSCslMonth    = Mid(WstrSCslDate, 6, 2)   '開始月
        strSCslDay      = Mid(WstrSCslDate, 10, 2)  '開始日
    Else
        strSCslYear     = Request("strCslYear")     '開始年
        strSCslMonth    = Request("strCslMonth")    '開始月
        strSCslDay      = Request("strCslDay")      '開始日
    End If

   strSCslDate   = strSCslYear & "/" & strSCslMonth & "/" & strSCslDay

'◆ 終了年月日
    If IsEmpty(Request("endCslYear")) Then
        WstrECslDate    = DateAdd("M", -9, Now)
        strECslYear     = Mid(WstrSCslDate, 1, 4)   '終了年
        strECslMonth    = Mid(WstrSCslDate, 6, 2)   '開始月
        strECslDay      = Mid(WstrSCslDate, 10, 2)  '開始日
    Else
        strECslYear     = Request("endCslYear")     '終了年
        strECslMonth    = Request("endCslMonth")    '開始月
        strECslDay      = Request("endCslDay")      '開始日
    End If

   strECslDate   = strECslYear & "/" & strECslMonth & "/" & strECslDay

'◆ 開始年月日と終了年月日の大小判定と入替
'   （日付型に変換してチェックしないのは日付として誤った値であったときのエラー回避の為）
    If Right("0000" & Trim(CStr(strSCslYear)), 4) & _
       Right("00" & Trim(CStr(strSCslMonth)), 2) & _
       Right("00" & Trim(CStr(strSCslDay)), 2) _
     > Right("0000" & Trim(CStr(strECslYear)), 4) & _
       Right("00" & Trim(CStr(strECslMonth)), 2) & _
       Right("00" & Trim(CStr(strECslDay)), 2) Then

        strSCslYear     = strECslYear
        strSCslMonth    = strECslMonth
        strSCslDate     = strECslDate
        strECslYear     = Request("strCslYear")     '開始年
        strECslMonth    = Request("strCslMonth")    '開始月
        strECslDay      = Request("strCslDay")      '開始日

        strECslDate     = strECslYear & "/" & strECslMonth & "/" & strECslDay

    End If


'◆予約 開始年月日
    If IsEmpty(Request("YstrCslYear")) Then
        WYstrSCslDate   = DateAdd("M", -4, Now)
        YstrSCslYear    = Mid(WYstrSCslDate, 1, 4)  '開始年
        YstrSCslMonth   = Mid(WYstrSCslDate, 6, 2)  '開始月
    Else
        YstrSCslYear    = Request("YstrCslYear")    '開始年
        YstrSCslMonth   = Request("YstrCslMonth")   '開始月
    End If
    YstrSCslDate        = YstrSCslYear & "/" & YstrSCslMonth 

'◆ 予約終了年月日
    If IsEmpty(Request("YendCslYear")) Then
        WYstrECslDate   = DateAdd("M", +4, Now)
        YstrECslYear    = Mid(WYstrECslDate, 1, 4)
        YstrECslMonth   = Mid(WYstrECslDate, 6, 2)
    Else
        YstrECslYear    = Request("YendCslYear")    '終了年
        YstrECslMonth   = Request("YendCslMonth")   '開始月
    End If
    YstrECslDate        = YstrECslYear & "/" & YstrECslMonth 

'◆ 予約開始年月日と予約終了年月日の大小判定と入替
'   （日付型に変換してチェックしないのは日付として誤った値であったときのエラー回避の為）
    If Right("0000" & Trim(CStr(YstrSCslYear)), 4) & _
       Right("00" & Trim(CStr(YstrSCslMonth)), 2) _
     > Right("0000" & Trim(CStr(YstrECslYear)), 4) & _
       Right("00" & Trim(CStr(YstrECslMonth)), 2) Then
        YstrSCslYear    = YstrECslYear
        YstrSCslMonth   = YstrECslMonth
        YstrSCslDate    = YstrECslDate
        YstrECslYear    = Request("YstrCslYear")    '開始年
        YstrECslMonth   = Request("YstrCslMonth")   '開始月
        YstrECslDate    = YstrECslYear & "/" & YstrECslMonth
    End If

    strCsCd         = Request("csCd")         'コースコード

'◆ 団体
    strOrgCd1       = Request("orgCd1")       '団体コード１
    strOrgCd2       = Request("orgCd2")       '団体コード２
    If strOrgCd1 <> "" And strOrgCd2 <> "" Then
        objOrganization.SelectOrg_Lukes strOrgCd1, strOrgCd2, , strOrgName
    End If

'◆ コメント
    strNotes        = Request("notes")         'コメント

    UID             = Session("USERID")

End Sub

'-------------------------------------------------------------------------------
'
' 機能　　 : 引数値の妥当性チェックを行う
'
' 引数　　 :
'
' 戻り値　 : エラー値がある場合、エラーメッセージの配列を返す
'
' 備考　　 :
'
'-------------------------------------------------------------------------------
Function CheckValue()

    Dim vntArrMessage    'エラーメッセージの集合

    'ここにチェック処理を記述
    With objCommon
'例)        .AppendArray vntArrMessage, コメント

        If strMode <> "" Then
'## 2003/12/27 Del NSC@Itoh
'            If Not IsDate(strSCslDate) Then
'                .AppendArray vntArrMessage, "開始日付が正しくありません。"
'            End If
'            If Not IsDate(strECslDate) Then
'                .AppendArray vntArrMessage, "終了日付が正しくありません。"
'            End If
'##2004/07/23 復旧 stLuke@sdjang
            If Not IsDate(strSCslDate) Then
                .AppendArray vntArrMessage, "開始日付が正しくありません。"
            End If
            If Not IsDate(strECslDate) Then
                .AppendArray vntArrMessage, "終了日付が正しくありません。"
            End If
        End If

    End With

    '戻り値の編集
    If IsArray(vntArrMessage) Then
        CheckValue = vntArrMessage
    End If

End Function

'-------------------------------------------------------------------------------
'
' 機能　　 : 帳票ドキュメントファイル作成処理
'
' 引数　　 :
'
' 戻り値　 : 印刷ログ情報のシーケンス値
'
' 備考　　 : 帳票ドキュメントファイル作成メソッドを呼び出す。メソッド内では次の処理が行われる。
' 　　　　   ?@印刷ログ情報の作成
' 　　　　   ?A帳票ドキュメントファイルの作成
' 　　　　   ?B処理成功時は印刷ログ情報レコードの主キーであるプリントSEQを戻り値として返す。
' 　　　　   このSEQ値を元に以降のハンドリングを行う。
'
'-------------------------------------------------------------------------------
Function Print()

    Dim objCommon       '共通クラス
    Dim objPrintCls     '1年目はがき出力用COMコンポーネント
    Dim Ret             '関数戻り値

    If Not IsArray(CheckValue()) Then

        '情報漏えい対策用ログ書き出し
        Call putPrivacyInfoLog("PH015", "一年目はがきの印刷を行った")

          Set objCommon = Server.CreateObject("HainsCommon.Common")

        'オブジェクトのインスタンス作成（プロジェクト名.クラス名）
        Set objPrintCls = Server.CreateObject("HainsprtAfterPostcard.prtAfterPostcard")

        'ドキュメントファイル作成処理（オブジェクト.メソッド名(引数)）
'## 2015/06/17 張 画面から編集した案内文章を追加 #####################################################################
'        Ret = objPrintCls.PrintOut(UID, strSCslDate, strECslDate, YstrSCslDate, YstrECslDate, strOrgCd1, strOrgCd2)
        Ret = objPrintCls.PrintOut(UID, strSCslDate, strECslDate, YstrSCslDate, YstrECslDate, strOrgCd1, strOrgCd2, strNotes)
        Print = Ret

    End If

End Function
%>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML LANG="ja">
<HEAD>
<LINK REL="stylesheet" TYPE="text/css" HREF="/webHains/contents/css/default.css">
<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=Shift_JIS">
<meta http-equiv="Content-Style-Type"  content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<TITLE>1年目はがき</TITLE>
<!-- #include virtual = "/webHains/includes/calGuide.inc"     -->
<!-- #include virtual = "/webHains/includes/orgPostGuide.inc" -->
<SCRIPT TYPE="text/javascript">
<!--
// エレメントの参照設定
function setNote() {

    var wk_Note;

    with ( document.entryForm ) {
        wk_Note = ''
        wk_Note = wk_Note + 'その後いかがお過ごしでしょうか。\n';
        wk_Note = wk_Note + '前回ご受診日よりもうすぐ１年となります。\n';
        wk_Note = wk_Note + 'ご予約は裏面の電話またはインターネットにて\n';
        wk_Note = wk_Note + '承っております。\n';
        wk_Note = wk_Note + '皆様からのご予約をお待ちしております。\n';
        notes.value = wk_Note;
    }
}


function setElement() {

    with ( document.entryForm ) {
        // 団体・所属情報エレメントの参照設定（入力項目に団体・所属が無い場合は不要）
        orgPostGuide_getElement( orgCd1, orgCd2, 'orgName' );
    }
}

//-->
</SCRIPT>
<script TYPE="text/javascript" src="/webHains/js/checkRunState.js?v=1.2"></script>
<STYLE TYPE="text/css">
td.prttab  { background-color:#ffffff }
</STYLE>
</HEAD>
<BODY ONLOAD="javascript:setElement();setNote();checkRunState();">

<!-- #include virtual = "/webHains/includes/navibar.inc" -->
<FORM NAME="entryForm" ACTION="<%= Request.ServerVariables("SCRIPT_NAME") %>" onsubmit="setRunState();">
	<INPUT TYPE="hidden" NAME="runstate" VALUE="">
    <BLOCKQUOTE>

<!--- タイトル -->
    <TABLE BORDER="0" CELLPADDING="2" CELLSPACING="1" BGCOLOR="#999999" WIDTH="650">
        <TR>
            <TD HEIGHT="15" BGCOLOR="#ffffff" NOWRAP><B><SPAN CLASS="print">■一年目はがき</SPAN></B></TD>
        </TR>
    </TABLE>
    <BR>

<!--- 日付 -->
    <TABLE BORDER="0" CELLPADDING="1" CELLSPACING="2">
        <TR>
            <TD><FONT COLOR="#ff0000">■</FONT></TD>
            <TD WIDTH="90" NOWRAP>受診日</TD>
            <TD>：</TD>
            <TD><A HREF="javascript:calGuide_showGuideCalendar('strCslYear', 'strCslMonth', 'strCslDay')"><IMG SRC="/webHains/images/question.gif" WIDTH="21" HEIGHT="21" ALT="日付ガイドを表示"></A></TD>
            <TD><%= EditNumberList("strCslYear", YEARRANGE_MIN, YEARRANGE_MAX, strSCslYear, False) %></TD>
            <TD>年</TD>
            <TD><%= EditNumberList("strCslMonth", 1, 12, strSCslMonth, False) %></TD>
            <TD>月</TD>
            <TD><%= EditNumberList("strCslDay", 1, 31, strSCslDay, False) %></TD>
            <TD>日</TD>
            <TD>〜</TD>
            <TD><A HREF="javascript:calGuide_showGuideCalendar('endCslYear', 'endCslMonth', 'endCslDay')"><IMG SRC="/webHains/images/question.gif" WIDTH="21" HEIGHT="21" ALT="日付ガイドを表示"></A></TD>
            <TD><%= EditNumberList("endCslYear", YEARRANGE_MIN, YEARRANGE_MAX, strECslYear, False) %></TD>
            <TD>年</TD>
            <TD><%= EditNumberList("endCslMonth", 1, 12, strECslMonth, False) %></TD>
            <TD>月</TD>
            <TD><%= EditNumberList("endCslDay", 1, 31, strECslDay, False) %></TD>
            <TD>日</TD>
        </TR>
    </TABLE>
<!--- 日付 -->
    <TABLE BORDER="0" CELLPADDING="1" CELLSPACING="2">
        <TR>
            <TD><FONT COLOR="#ff0000">■</FONT></TD>
            <TD WIDTH="90" NOWRAP>予約年月</TD>
            <TD>：</TD>
            <TD><A HREF="javascript:calGuide_showGuideCalendar('YstrCslYear', 'YstrCslMonth', 'YstrCslDay')"><IMG SRC="/webHains/images/question.gif" WIDTH="21" HEIGHT="21" ALT="日付ガイドを表示"></A></TD>
            <TD><%= EditNumberList("YstrCslYear", YEARRANGE_MIN, YEARRANGE_MAX, YstrSCslYear, False) %></TD>
            <TD>年</TD>
            <TD><%= EditNumberList("YstrCslMonth", 1, 12, YstrSCslMonth, False) %></TD>
            <TD>月</TD>
            <TD>〜</TD>
            <TD><A HREF="javascript:calGuide_showGuideCalendar('YendCslYear', 'YendCslMonth', 'YendCslDay')"><IMG SRC="/webHains/images/question.gif" WIDTH="21" HEIGHT="21" ALT="日付ガイドを表示"></A></TD>
            <TD><%= EditNumberList("YendCslYear", YEARRANGE_MIN, YEARRANGE_MAX, YstrECslYear, False) %></TD>
            <TD>年</TD>
            <TD><%= EditNumberList("YendCslMonth", 1, 12, YstrECslMonth, False) %></TD>
            <TD>月</TD>
        </TR>
    </TABLE>

<!--- 団体 -->
    <INPUT TYPE="hidden" NAME="orgCd1" VALUE="<% = strOrgCd1 %>">
    <INPUT TYPE="hidden" NAME="orgCd2" VALUE="<% = strOrgCd2 %>">

    <TABLE BORDER="0" CELLPADDING="1" CELLSPACING="2">
        <TR>
            <TD>□</TD>
            <TD WIDTH="90" NOWRAP>団体</TD>
            <TD>：</TD>
            <TD><A HREF="javascript:orgPostGuide_showGuideOrg()"><IMG SRC="/webHains/images/question.gif" WIDTH="21" HEIGHT="21" ALT="団体検索ガイドを表示"></A></TD>
            <TD><A HREF="javascript:orgPostGuide_clearOrgInfo()"><IMG SRC="/webHains/images/delicon.gif"  WIDTH="21" HEIGHT="21" ALT="設定した値をクリア"></A></TD>
            <TD NOWRAP><SPAN ID="orgName"><% = strOrgName %></SPAN></TD>
        </TR>
    </TABLE>
    <!--- コメント -->
    <TABLE BORDER="0" CELLPADDING="1" CELLSPACING="2">
        <TR>
            <TD>□</TD>
            <TD WIDTH="90" NOWRAP>コメント</TD>
            <TD>：</TD>
            <TD><TEXTAREA NAME="notes" COLS="60" ROWS="7" STYLE="ime-mode:active;"></TEXTAREA></TD>
        </TR>
    </TABLE>
<!--- 出力対象 --><BR>
<!--- 印刷モード -->
<%
    '印刷モードの初期設定
    strMode = IIf(strMode = "", PRINTMODE_PREVIEW, strMode)
%>
    <TABLE BORDER="0" CELLPADDING="1" CELLSPACING="0">
        <INPUT TYPE="hidden" NAME="mode" VALUE="0">
    </TABLE>

    <BR><BR>

<!--- 印刷ボタン -->
    <!---2006.07.04 権限管理 追加 by 李  -->
    <% If Session("PAGEGRANT") = "4" Then   %>
        <INPUT TYPE="image" NAME="print" SRC="/webHains/images/print.gif" WIDTH="77" HEIGHT="24" ALT="印刷する">
    <%  End if  %>

    </BLOCKQUOTE>

</FORM>
<DIV ALIGN="right"><FONT COLOR="#ffffff">.</FONT></DIV>

</BODY>
</HTML>