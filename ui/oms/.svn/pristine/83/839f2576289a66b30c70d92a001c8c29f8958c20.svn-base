<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.rkylin.oms.system.menu.dao.MenuDAOImpl">
	<resultMap id="WF_ORG_MENUResultMap" type="cn.rkylin.oms.system.menu.domain.WF_ORG_MENU" >
	    <id column="MENU_CODE" property="menuCode" jdbcType="VARCHAR" />
	    <result column="PARENT_MENU_CODE" property="parentMenuCode" jdbcType="VARCHAR" />
	    <result column="MENU_NAME" property="menuName" jdbcType="VARCHAR" />
	    <result column="MENU_AREA" property="menuArea" jdbcType="VARCHAR" />
	    <result column="MENU_LOCATION" property="menuLocation" jdbcType="VARCHAR" />
	    <result column="MENU_IMG_LOCATION" property="menuImgLocation" jdbcType="VARCHAR" />
	    <result column="MENU_DESC" property="menuDesc" jdbcType="VARCHAR" />
	    <result column="MENU_ORDER" property="menuOrder" jdbcType="INTEGER" />
	    <result column="MENU_ELEMENT_ID" property="menuElementId" jdbcType="VARCHAR" />
	    <result column="MENU_ELEMENT_TYPE" property="menuElementType" jdbcType="VARCHAR" />
	    <result column="MENU_TYPE" property="menuType" jdbcType="VARCHAR" />
	    <result column="MENU_IS_DEFAULT" property="menuIsDefault" jdbcType="VARCHAR" />
	    <result column="MENU_LEVEL" property="menuLevel" jdbcType="INTEGER" />
  	</resultMap>
  	
  	 <select id="select" resultMap="WF_ORG_MENUResultMap" parameterType="cn.rkylin.oms.system.menu.domain.WF_ORG_MENU" >
	    select MENU_CODE, PARENT_MENU_CODE, MENU_NAME, MENU_AREA, MENU_LOCATION, MENU_IMG_LOCATION,
	      MENU_DESC, MENU_ORDER, MENU_ELEMENT_ID, MENU_TYPE,MENU_IS_DEFAULT
	    from WF_ORG_MENU
	  </select>
 
 
   <resultMap id="WF_ORG_MENU_TreeResultMap" type="cn.rkylin.oms.system.menu.domain.WF_ORG_MENU" >
    <id column="MENU_CODE" property="menuCode" jdbcType="VARCHAR" />
    <result column="PARENT_MENU_CODE" property="parentMenuCode" jdbcType="VARCHAR" />
    <result column="MENU_NAME" property="menuName" jdbcType="VARCHAR" />
    <result column="MENU_AREA" property="menuArea" jdbcType="VARCHAR" />
    <result column="MENU_LOCATION" property="menuLocation" jdbcType="VARCHAR" />
    <result column="MENU_IMG_LOCATION" property="menuImgLocation" jdbcType="VARCHAR" />
    <result column="MENU_DESC" property="menuDesc" jdbcType="VARCHAR" />
    <result column="MENU_ELEMENT_ID" property="menuElementId" jdbcType="VARCHAR" />
    <result column="MENU_ELEMENT_TYPE" property="menuElementType" jdbcType="VARCHAR" />
    <result column="MENU_TYPE" property="menuType" jdbcType="VARCHAR" />
    <result column="MENU_IS_DEFAULT" property="menuIsDefault" jdbcType="VARCHAR" />
  </resultMap>
	
	 <select id="selectMenuPart1" resultType="java.util.HashMap" parameterType="cn.rkylin.oms.system.menu.domain.WF_ORG_MENU">
   SELECT #{userID} ROLE_ID
	 FROM DUAL
	  UNION ALL
	  SELECT DISTINCT (R.ROLE_ID) ROLE_ID
	    FROM WF_ORG_USER_ROLE R
	   WHERE R.USER_ID = #{userID}
		<if test="roleType = 'bizRole'">
        and R.ROLE_ID NOT IN (SELECT T3.ROLE_ID
                                FROM WF_ORG_ROLE T3
                               WHERE T3.IS_ADMINROLE = 'æ˜¯')
		</if>
	  UNION ALL
	  SELECT DISTINCT (U.UNIT_ID) ROLE_ID
	    FROM WF_ORG_USER_UNIT U
	   WHERE U.USER_ID = #{userID}
	  UNION ALL
	  SELECT DISTINCT (S.STATION_ID) ROLE_ID
	    FROM WF_ORG_USER_STATION S
    WHERE S.USER_ID = #{userID}
  </select>
  
  
  <resultMap type="cn.rkylin.oms.system.delegate.domain.WF_ORG_DELEGATE" id="WF_ORG_DELEGATEResultMap">
    <id column="DELE_ID" jdbcType="VARCHAR" property="deleId" />
    <result column="USER_ID" jdbcType="VARCHAR" property="userId" />
    <result column="TRUSTOR_ID" jdbcType="VARCHAR" property="trustorId" />
    <result column="DELE_NAME" jdbcType="VARCHAR" property="deleName" />
    <result column="DELE_DESCRIPTION" jdbcType="VARCHAR" property="deleDescription" />
    <result column="DELE_TIME_BEGIN" jdbcType="VARCHAR" property="deleTimeBegin" />
    <result column="DELE_TIME_END" jdbcType="VARCHAR" property="deleTimeEnd" />
    <result column="DELE_ALL_PRIVIL" jdbcType="CHAR" property="deleAllPrivil" />
    <result column="TRUSTOR_NAME" jdbcType="VARCHAR" property="trustor_name" />
    <result column="USER_NAME" jdbcType="VARCHAR" property="userName" />
  </resultMap>
   <select id="getUserAvailableDelegate" resultMap="WF_ORG_DELEGATEResultMap" parameterType="java.lang.String" >
  	<![CDATA[
        SELECT
		    DELE_ID,
		    USER_ID,
		    TRUSTOR_ID,
		    DELE_NAME,
		    DELE_DESCRIPTION,
		    DELE_TIME_BEGIN,
		    DELE_TIME_END,
		    DELE_ALL_PRIVIL,
		    '' TRUSTOR_NAME,
		    '' USER_NAME
        FROM
            WF_ORG_DELEGATE
        WHERE
            TRUSTOR_ID = #value#
        AND
            ((
                WF_ORG_DELEGATE.DELE_TIME_BEGIN <= sysdate
            AND WF_ORG_DELEGATE.DELE_TIME_END >= sysdate
            )
         OR
            (
                WF_ORG_DELEGATE.DELE_TIME_BEGIN IS NULL
            AND WF_ORG_DELEGATE.DELE_TIME_END >= sysdate
            )
         OR
            (
                WF_ORG_DELEGATE.DELE_TIME_BEGIN <= sysdate
            AND WF_ORG_DELEGATE.DELE_TIME_END IS NULL
            )
         OR
            (
                WF_ORG_DELEGATE.DELE_TIME_BEGIN IS NULL
            AND WF_ORG_DELEGATE.DELE_TIME_END IS NULL
            ))
  	]]>
  </select>
  
  <select id="getUserDelegatedRoles" resultType="java.util.HashMap" parameterType="java.lang.String" >
	<![CDATA[
	SELECT
	    DI_PRIV_ID ROLE_ID
	FROM
	    WF_ORG_DELEITEM T1
	LEFT JOIN WF_ORG_DELEGATE T2
	ON
	    T2.DELE_ID = T1.DELE_ID
	WHERE
	    T2.TRUSTOR_ID = #value#
	AND T2.DELE_ID IN
	    (
	        SELECT
	            DELE_ID
	        FROM
	            WF_ORG_DELEGATE
	        WHERE
	            TRUSTOR_ID = #{value}
	        AND
	            ((
	                WF_ORG_DELEGATE.DELE_TIME_BEGIN <= GETDATE()
	            AND WF_ORG_DELEGATE.DELE_TIME_END >= GETDATE()
	            )
	         OR
	            (
	                WF_ORG_DELEGATE.DELE_TIME_BEGIN IS NULL
	            AND WF_ORG_DELEGATE.DELE_TIME_END >= GETDATE()
	            )
	         OR
	            (
	                WF_ORG_DELEGATE.DELE_TIME_BEGIN <= GETDATE()
	            AND WF_ORG_DELEGATE.DELE_TIME_END IS NULL
	            )
	         OR
	            (
	                WF_ORG_DELEGATE.DELE_TIME_BEGIN IS NULL
	            AND WF_ORG_DELEGATE.DELE_TIME_END IS NULL
	            ))
	    )
	]]>
  </select>
</mapper>