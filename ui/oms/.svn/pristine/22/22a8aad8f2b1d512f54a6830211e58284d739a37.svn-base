<html>
	<body>
		<link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/jquery-ui-1.10.4.custom/css/ui-lightness/jquery-ui-1.10.4.custom.min.css" />
        <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/font-awesome/css/font-awesome.min.css" />
        <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/bootstrap/css/bootstrap.min.css" />
        
        <!-- 加载本页需要的三方插件样式 -->
	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/DataTables/media/css/jquery.dataTables.css">
	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/DataTables/extensions/TableTools/css/dataTables.tableTools.min.css">
	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/DataTables/media/css/dataTables.bootstrap.css">
	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/jquery-tablesorter/themes/blue/style-custom.css">
	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/jquery-bootstrap-wizard/custom.css">
<!-- 	    <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/jquery-steps/css/jquery.steps.css"> -->
<!--         <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/animate.css/animate.css" /> -->
<!--         <link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/iCheck/skins/all.css" /> -->
<!--     	<link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css"> -->
<!--     	<link type="text/css" rel="stylesheet" href="/Apollo/madmin/vendors/user.css/jquery.ui.all.css"> -->
<!--         加载主题风格样式 -->
<!--         <link type="text/css" rel="stylesheet" href="/Apollo/madmin/css/themes/style1/orange-blue.css" class="default-style" /> -->
<!--         <link type="text/css" rel="stylesheet" href="/Apollo/madmin/css/themes/style1/orange-blue.css" id="theme-change" class="style-change color-change" /> -->
<!--         <link type="text/css" rel="stylesheet" href="/Apollo/madmin/css/style-responsive.css" /> -->
        <link type="text/css" rel="stylesheet" href="dhtmlxtree.css" />
								<table width="100%" height="200px" border="0">
								    <tr>
									    <td>
											<div id="orgTreeFrame" style="width:100%; height:200px;"></div>
										</td>
									</tr>
									<tr>
										<td align="right">
											<div class="modal-footer">
								                <button id="unitSave" type="button"  class="btn btn-primary">保存</button>
								                <button type="button" data-dismiss="modal" class="btn btn-default">关闭</button>
								            </div>
										</td>
									</tr>
								</table>
		<script src="/Apollo/madmin/js/jquery-1.10.2.min.js"></script>
	    <script src="/Apollo/madmin/js/jquery-migrate-1.2.1.min.js"></script>
	    <script src="/Apollo/madmin/js/jquery-ui.js"></script>
	    
	    <!-- 加载 bootstrap 和三方插件 js -->
	    <script src="/Apollo/madmin/vendors/bootstrap/js/bootstrap.min.js"></script>
	    <script src="/Apollo/madmin/vendors/bootstrap-hover-dropdown/bootstrap-hover-dropdown.js"></script>
	    <script src="/Apollo/madmin/js/html5shiv.js"></script>
	    <script src="/Apollo/madmin/js/respond.min.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-cookie/jquery.cookie.js"></script>
	    <script src="/Apollo/madmin/vendors/iCheck/icheck.min.js"></script>
	    <script src="/Apollo/madmin/vendors/iCheck/custom.min.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-notific8/jquery.notific8.min.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-pace/pace.min.js"></script>
	    <script src="/Apollo/madmin/vendors/holder/holder.js"></script>
	    <script src="/Apollo/madmin/vendors/responsive-tabs/responsive-tabs.js"></script>
	    <script src="/Apollo/madmin/vendors/moment/moment.js"></script>
		<script src="/Apollo/madmin/vendors/bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
	    <script src="/Apollo/madmin/vendors/DataTables/media/js/jquery.dataTables.js"></script>
	    <script src="/Apollo/madmin/vendors/DataTables/media/js/dataTables.bootstrap.js"></script>
	    <script src="/Apollo/madmin/vendors/DataTables/extensions/TableTools/js/dataTables.tableTools.min.js"></script>
    	<script src="/Apollo/madmin/vendors/jquery-tablesorter/jquery.tablesorter.js"></script>
    	<script src="/Apollo/madmin/js/table-advanced.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-validate/jquery.validate.min.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-validate/message_zh.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-steps/js/jquery.steps.min.js"></script>
	    <script src="/Apollo/madmin/vendors/jquery-bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>

	    <!-- 加载本页面对应的js -->
	    <script src="Arraylist.js"></script> 
	    <script src="dhtmlxcommon.js"></script> 
	    <script src="dhtmlxmenu.js"></script> 
	    <script src="dhtmlxtree.js"></script> 
	    <script src="dhtmlXTreeExtend.js"></script> 
	    <script src="UserList.js"></script> 
	    <script src="DivDialogUtil.js"></script>
	    <script src="/views/static/js/export.js"></script>
	    <script src="/views/static/js/form.js"></script>
	    
	    <script type="text/javascript">
	    initTree();
	    
	    function initTree(){
	    	debugger
	    	$("#orgTreeFrame").children().remove();
	    	$('body').bind('keydown',shieldCommon);
	    	//处理传入的参数
	    	//obj = window.dialogArguments;// 定义一个对象用于接收对话框参数
	    	isMultiSelect = (isMultiSelect && isMultiSelect != "" ? isMultiSelect : false);	
	    	needStation = (needStation && needStation != "" ? needStation : false);
	    	//处理树
	    	tree =new dhtmlXTreeObject("orgTreeFrame","100%","100%",0);
	        tree.setImagePath("/csh_books/");
	        if (isMultiSelect == "true"){
	        	tree.enableCheckBoxes(1);
	        	tree.enableThreeStateCheckboxes(false);
	        }
	        if(needStation){
	            tree.setOnOpenEndHandler(checkSubNodes);  //解决节点请求回来无法展开
	        	tree.setOnMouseInHandler(beforeOpenNode);
	        	tree.setXMLAutoLoading("/unit/getSubUnitTree.action?needStation=true"); 
	        	tree.loadXML("/unit/getUnitTree.action?needStation=true");
	        }else{
	            tree.setOnOpenEndHandler(checkSubNodes);  //解决节点请求回来无法展开
	        	tree.setOnMouseInHandler(beforeOpenNode);
	        	tree.setXMLAutoLoading("/unit/getSubUnitTree.action"); 
	        	tree.loadXML("/unit/getUnitTree.action");
	        }
	        tree.openItem("RootUnit@UNIT");
	    	window.setTimeout(function() {
	    		//tree.closeAllItems(0);
	    	}, 0);
	    	getUnitTreeManageableInitTree();
	    }
	    
	    function getUnitTreeManageableInitTree(){	
	    	jQuery.ajax({
	    		url:"/unit/getUnitTreeManageable.action",
	    		type:"post",
	    		async:false,
	    		dataType:"json",
	    		success:function(data){
	    			if(data.errorMessage==null || data.errorMessage==undefined){
	    				for(var i=0;i<data.length;i++){
	    					if(data[i].MANAGEABLE != 1){
	    						tree.showItemCheckbox(data[i].UNIT_ID,false); //隐藏复选框
	    						tree.setItemColor(data[i].UNIT_ID,"#aaaaaa","#aaaaaa");//节点字体颜色置灰
	    					}
	    				}
	    			} else {
	    				if (data.errorMessage == "session timeout")
	    					window.location.href = "/login.jsp";
	    				else
	    					alert(data.errorMessage);
	    			}
	    		}
	    	});
	    	
	    }
	    </script>
	</body>
</html>	