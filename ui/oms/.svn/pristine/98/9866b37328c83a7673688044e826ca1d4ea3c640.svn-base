<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.rkylin.oms.system.unit.dao.UnitDAOImpl">
	<resultMap id="Unit_BaseResultMap" type="cn.rkylin.oms.system.unit.domain.WF_ORG_UNIT">
	 	<id column="UNIT_ID" jdbcType="VARCHAR" property="unitId" />
	    <result column="PARENT_UNIT_ID" jdbcType="VARCHAR" property="parentUnitId" />
	    <result column="STATION_ID" jdbcType="VARCHAR" property="stationId" />
	    <result column="STATION_NAME" jdbcType="VARCHAR" property="stationName" />
	    <result column="UNIT_NAME" jdbcType="VARCHAR" property="unitName" />
	    <result column="UNIT_DESCRIPTION" jdbcType="VARCHAR" property="unitDescription" />
	    <result column="UNIT_TYPE" jdbcType="VARCHAR" property="unitType" />
	    <result column="MANAGEABLE" jdbcType="VARCHAR" property="manageable" />
	</resultMap>

	<select id="getUnitByCondition" parameterType="cn.rkylin.oms.system.unit.domain.WF_ORG_UNIT" resultMap="Unit_BaseResultMap">
	SELECT UNIT_ID,
	       PARENT_UNIT_ID,
	       STATION_ID,
	       (SELECT STATION_NAME
	          FROM WF_ORG_STATION STATION
	         WHERE STATION.STATION_ID = UNIT.STATION_ID) AS STATION_NAME,
	       UNIT_NAME,
	       UNIT_DESCRIPTION,
	       UNIT_TYPE,
	       '1' AS MANAGEABLE
	  FROM WF_ORG_UNIT UNIT
		where 1=1
		<if test="unitId != null">
			and UNIT_ID = #{unitId}
		</if>
		<if test="parentUnitId != null">
			and PARENT_UNIT_ID = #{parentUnitId}
		</if>
		<if test="unitName != null">
			and UNIT_NAME = #{unitName}
		</if>
		<if test="unitType != null">
			and UNIT_TYPE = #{unitType}
		</if>
		<if test="manageable != null">
			and MANAGEABLE = #{manageable}
		</if>
		<if test="roleId != null">
			and UNIT.UNIT_ID IN
	       (SELECT A.UNIT_ID
	          FROM WF_ORG_ROLE_UNIT A
	         WHERE A.ROLE_ID = #{roleId})
		</if>
		<if test="userId != null">
			and UNIT.UNIT_ID IN
	       (SELECT A.UNIT_ID
	          FROM WF_ORG_USER_UNIT A
	         WHERE A.USER_ID = #{userId})
		</if>
		<if test="delegateUnitIdList != null">
			and UNIT.UNIT_ID exist
       			<foreach collection="array" item="delegateUnitIdList" index="index" close=")" open="(" separator=","> 
				  #{delegateUnitIdList} 
				</foreach>
		</if>
	</select>
</mapper>