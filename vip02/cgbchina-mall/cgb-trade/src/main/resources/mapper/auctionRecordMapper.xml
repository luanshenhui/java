<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AuctionRecordModel">
    <resultMap id="AuctionRecordMap" type="AuctionRecordModel">
        <result property="id" column="id"/>
        <result property="custId" column="cust_id"/>
        <result property="cell" column="cell"/>
        <result property="cardno" column="cardno"/>
        <result property="orderId" column="order_id"/>
        <result property="itemId" column="item_id"/>
        <result property="goodsNm" column="goods_nm"/>
        <result property="goodsPaywayId" column="goods_payway_id"/>
        <result property="auctionPrice" column="auction_price"/>
        <result property="auctionTime" column="auction_time"/>
        <result property="auctionId" column="auction_id"/>
        <result property="periodId" column="period_id"/>
        <result property="isBacklock" column="is_backlock"/>
        <result property="payFlag" column="pay_flag"/>
        <result property="beginPayTime" column="begin_pay_time"/>
        <result property="releaseTime" column="release_time"/>
        <result property="modifyTime" column="modify_time"/>
    </resultMap>
    <sql id="columns">
    id,cust_id,cell,cardno,order_id,item_id,goods_nm,goods_payway_id,auction_price,auction_time,auction_id,period_id,is_backlock,pay_flag,begin_pay_time,release_time,modify_time
    </sql>

    <insert id="insert" parameterType="AuctionRecordModel" useGeneratedKeys="true"
            keyProperty="id" keyColumn="id">
        insert into tbl_auction_record
        (cust_id
        ,cell
        ,cardno
        ,order_id
        ,item_id
        ,goods_nm
        ,goods_payway_id
        ,auction_price
        ,auction_time
        ,auction_id
        ,period_id
        ,is_backlock
        ,pay_flag
        ,begin_pay_time
        ,release_time
        ,modify_time)
        values(#{custId}
        ,#{cell}
        ,#{cardno}
        ,#{orderId}
        ,#{itemId}
        ,#{goodsNm}
        ,#{goodsPaywayId}
        ,#{auctionPrice}
        ,#{auctionTime}
        ,#{auctionId}
        ,#{periodId}
        ,#{isBacklock}
        ,#{payFlag}
        ,#{beginPayTime}
        ,#{releaseTime}
        ,#{modifyTime})
    </insert>

    <update id="update" parameterType="AuctionRecordModel">
        update tbl_auction_record
        <set>
            <if test="custId !=null">cust_id = #{custId}
                ,</if>
            <if test="cell !=null">cell = #{cell}
                ,</if>
            <if test="cardno !=null">cardno = #{cardno}
                ,</if>
            <if test="orderId !=null">order_id = #{orderId}
                ,</if>
            <if test="itemId !=null">item_id = #{itemId}
                ,</if>
            <if test="goodsNm !=null">goods_nm = #{goodsNm}
                ,</if>
            <if test="goodsPaywayId !=null">goods_payway_id = #{goodsPaywayId}
                ,</if>
            <if test="auctionPrice !=null">auction_price = #{auctionPrice}
                ,</if>
            <if test="auctionTime !=null">auction_time = #{auctionTime}
                ,</if>
            <if test="auctionId !=null">auction_id = #{auctionId}
                ,</if>
            <if test="periodId !=null">period_id = #{periodId}
                ,</if>
            <if test="isBacklock !=null">is_backlock = #{isBacklock}
                ,</if>
            <if test="payFlag !=null">pay_flag = #{payFlag}
                ,</if>
            <if test="beginPayTime !=null">begin_pay_time = #{beginPayTime}
                ,</if>
            <if test="releaseTime !=null">release_time = #{releaseTime}
                ,</if>
            <if test="modifyTime !=null">modify_time = #{modifyTime}
                </if>
        </set>
        where id = #{id}
    </update>

    <update id="updateByIdAndBackLock" parameterType="AuctionRecordModel">
        update tbl_auction_record
        <set>
            <if test="custId !=null">cust_id = #{custId}
                ,</if>
            <if test="cell !=null">cell = #{cell}
                ,</if>
            <if test="cardno !=null">cardno = #{cardno}
                ,</if>
            <if test="orderId !=null">order_id = #{orderId}
                ,</if>
            <if test="itemId !=null">item_id = #{itemId}
                ,</if>
            <if test="goodsNm !=null">goods_nm = #{goodsNm}
                ,</if>
            <if test="goodsPaywayId !=null">goods_payway_id = #{goodsPaywayId}
                ,</if>
            <if test="auctionPrice !=null">auction_price = #{auctionPrice}
                ,</if>
            <if test="auctionTime !=null">auction_time = #{auctionTime}
                ,</if>
            <if test="auctionId !=null">auction_id = #{auctionId}
                ,</if>
            <if test="periodId !=null">period_id = #{periodId}
                ,</if>
            <if test="isBacklock !=null">is_backlock = #{isBacklock}
                ,</if>
            <if test="payFlag !=null">pay_flag = #{payFlag}
                ,</if>
            <if test="beginPayTime !=null">begin_pay_time = #{beginPayTime}
                ,</if>
            <if test="releaseTime !=null">release_time = #{releaseTime}
                ,</if>
            <if test="modifyTime !=null">modify_time = #{modifyTime}
            </if>
        </set>
        where id = #{id} and isBacklock = '1'
    </update>

    <sql id="conditions">
        <where>
            <if test="id !=null">and id = #{id}</if>
            <if test="custId !=null">and cust_id = #{custId}</if>
            <if test="cell !=null">and cell = #{cell}</if>
            <if test="cardno !=null">and cardno = #{cardno}</if>
            <if test="orderId !=null">and order_id = #{orderId}</if>
            <if test="itemId !=null">and item_id = #{itemId}</if>
            <if test="goodsNm !=null">and goods_nm = #{goodsNm}</if>
            <if test="goodsPaywayId !=null">and goods_payway_id = #{goodsPaywayId}</if>
            <if test="auctionPrice !=null">and auction_price = #{auctionPrice}</if>
            <if test="auctionTime !=null">and auction_time = #{auctionTime}</if>
            <if test="auctionId !=null">and auction_id = #{auctionId}</if>
            <if test="periodId !=null">and period_id = #{periodId}</if>
            <if test="isBacklock !=null">and is_backlock = #{isBacklock}</if>
            <if test="payFlag !=null">and pay_flag = #{payFlag}</if>
            <if test="beginPayTime !=null">and begin_pay_time = #{beginPayTime}</if>
            <if test="releaseTime !=null">and release_time = #{releaseTime}</if>
            <if test="modifyTime !=null">and modify_time = #{modifyTime}</if>
        </where>
    </sql>
    <select id="findById" parameterType="Map" resultMap="AuctionRecordMap">
       SELECT
        <include refid="columns"/>
        from tbl_auction_record
       where id=#{id}
    </select>
    <select id="findByIds" parameterType="Map" resultMap="AuctionRecordMap">
        SELECT
          <include refid="columns"/>
        from tbl_auction_record
        where id in
        <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="findAll" resultMap="AuctionRecordMap">
        select id,
        <include refid="columns"/>
        from tbl_auction_record
        <include refid="conditions"/>
    </select>
    <select id="findByParam" parameterType="Map" resultMap="AuctionRecordMap">
        select
        <include refid="columns"/>
        from tbl_auction_record
        <include refid="conditions"/>
        <![CDATA[ order by auction_time desc ]]>
    </select>
    <select id="pager" parameterType="Map" resultMap="AuctionRecordMap">
        select id,
        <include refid="columns"/>
        from tbl_auction_record
        <include refid="conditions"/>
        <![CDATA[ order by id desc limit #{offset}, #{limit} ]]>
    </select>
    <delete id="delete" parameterType="AuctionRecordModel">
        delete from tbl_auction_record where id = id
    </delete>

    <!-- 更新对应拍卖记录状态，标识已经释放库存 add by geshuo 20160726 -->
    <update id="updateRecordReleased" parameterType="Map">
        update tbl_auction_record
        set is_backlock = '0',
        release_time = now(),
        modify_time = now()
        where order_id = #{orderId}
        and is_backlock = '1'
    </update>

    <update id="updateHollandOrder" parameterType="AuctionRecordModel">
        update tbl_auction_record
        <set>
            <if test="custId !=null">cust_id = #{custId}
                ,</if>
            <if test="cell !=null">cell = #{cell}
                ,</if>
            <if test="cardno !=null">cardno = #{cardno}
                ,</if>
            <if test="orderId !=null">order_id = #{orderId}
                ,</if>
            <if test="itemId !=null">item_id = #{itemId}
                ,</if>
            <if test="goodsNm !=null">goods_nm = #{goodsNm}
                ,</if>
            <if test="goodsPaywayId !=null">goods_payway_id = #{goodsPaywayId}
                ,</if>
            <if test="auctionPrice !=null">auction_price = #{auctionPrice}
                ,</if>
            <if test="auctionTime !=null">auction_time = #{auctionTime}
                ,</if>
            <if test="auctionId !=null">auction_id = #{auctionId}
                ,</if>
            <if test="periodId !=null">period_id = #{periodId}
                ,</if>
            <if test="isBacklock !=null">is_backlock = #{isBacklock}
                ,</if>
            <if test="payFlag !=null">pay_flag = #{payFlag}
                ,</if>
            <if test="beginPayTime !=null">begin_pay_time = #{beginPayTime}
                ,</if>
            <if test="releaseTime !=null">release_time = #{releaseTime}
                ,</if>
            <if test="modifyTime !=null">modify_time = #{modifyTime}
            </if>
        </set>
        where id = #{id}
        and is_backlock = 1
    </update>
</mapper>


