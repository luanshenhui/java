<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SendOutSystem">
    <select id="findByCode" parameterType="String" resultType="cn.com.cgbchina.batch.model.ItemModel">
        select
        code as code,
        o2o_code as o2oCode,
        o2o_voucher_code as o2oVoucherCode
        from tbl_item
        where code=#{code}
    </select>

    <select id="findOrderList1" parameterType="Map" resultType="cn.com.cgbchina.batch.model.OrderList1Model">
        select
        too.order_main_id as orderMainId,
        too.order_id as orderId,
        tso.shop_id as shopId,
        tso.action_url as actionUrl,
        tso.key as shopKey,
        tso.outsystem_id as outsystemId,
        o.total_money as totalMoney,
        o.goods_num as goodsNum,
        o.single_price as singlePrice,
        o.goods_id as goodsId,
        o.ordertype_id as ordertypeId,
        o.cal_money as calMoney
        from
        tbl_vendor_inf v,
        tbl_order_outsystem too,
        tbl_shopinf_outsystem tso,
        tbl_order o
        where
        too.order_id = o.order_id
        and v.vendor_id = o.vendor_id
        and tso.shop_id = v.vendor_id
        and too.tuisong_flag = '0'
        and too.system_role = '00'
        and <![CDATA[too.times <= 6]]>
        and v.vendor_id = #{outSystemId}
        and too.order_main_id = #{orderMainId}
    </select>

    <select id="findByOrderMainId" parameterType="String" resultType="String">
        select
          csg_phone1 as csgPhone1
        from tbl_order_main
        where ordermain_id=#{ordermainId}
    </select>

    <update id="updateByOrderId" parameterType="cn.com.cgbchina.batch.model.OrderOutSystemModel">
        update tbl_order_outsystem
        <set>
            <if test="orderMainId !=null">order_main_id = #{orderMainId},</if>
            <if test="times !=null">times = times + #{times} ,</if>
            <if test="tuisongFlag !=null">tuisong_flag = #{tuisongFlag} ,</if>
            <if test="systemRole !=null">system_role = #{systemRole} ,</if>
            <if test="modifyOper !=null">modify_oper = #{modifyOper} ,</if>
            modify_time = now()
        </set>
        where order_id = #{orderId}
    </update>

    <select id="findOutsytemIds"  resultType="String">
        select distinct v.vendor_id
        from
        tbl_vendor_inf v,
        tbl_order_outsystem too,
        tbl_order o
        where
        o.cur_status_id = '0308'
        and too.order_id = o.order_id
        and v.vendor_id = o.vendor_id
        and too.tuisong_flag = '0'
        and <![CDATA[too.times <= 6]]>
        and too.system_role = '00'
    </select>

    <select id="findOrderMainList" parameterType="String" resultType="String">
        select distinct
        too.order_main_id
        from
        tbl_vendor_inf v,
        tbl_order_outsystem too,
        tbl_shopinf_outsystem tso,
        tbl_order o
        where
        o.cur_status_id = '0308'
        and too.order_id = o.order_id
        and v.vendor_id = o.vendor_id
        and tso.shop_id = v.vendor_id
        and too.tuisong_flag = '0'
        and too.system_role = '00'
        and <![CDATA[too.times <= 6]]>
        and v.vendor_id =#{outSystemId}
    </select>
</mapper>


