<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yulin.cateMapping">
	<select id="findByIdCate" parameterType="int" resultType="com.yulin.dangdang.bean.Category">
		select * from d_category where id = #{id}
	</select>
	<select id="findByparent" parameterType="int" resultType="com.yulin.dangdang.bean.Category">
		select * from d_category where parent_id = #{parent_id};
	</select>
	<!-- 第一种方法，连接book_list2.jsp
	<select id="findProduct" parameterType="int" resultType="com.yulin.dangdang.bean.Product">
		select * from d_product where id in (select product_id from d_category_product where cat_id = #{id});
	</select>
	
	<select id="findBook" parameterType="int" resultType="com.yulin.dangdang.bean.Book">
		select * from d_book where id in (select id from d_product where id = #{id});
	</select>
	 -->
	 <!-- 通过cateId获得所有的product -->
	 <select id="findById" parameterType="int" resultMap="Product">
	select * from d_product where id in (select product_id from d_category_product where cat_id = #{id}
	);
	</select>
	<!-- 映射的方法 book_list.jsp -->

	<select id="findBook" parameterType="map" resultMap="Product">
	select * from d_product where id in (select product_id from d_category_product where cat_id = #{id}
	) limit #{page}, 5;
	</select>
	<select id="findProductId" parameterType="int" resultType="com.yulin.dangdang.bean.Book">
		select * from d_book where id = #{id}
	</select>
	<resultMap type="com.yulin.dangdang.bean.Product" id="Product">
		<id property="id" column="id"/>
		<result property="product_name" column="product_name"/>
		<result property="description" column="description"/>
		<result property="add_time" column="add_time"/>
		<result property="fixed_price" column="fixed_price"/>
		<result property="dang_price" column="dang_price"/>
		<result property="keywords" column="keywords"/>
		<result property="has_deleted" column="has_deleted"/>
		<result property="product_pic" column="product_pic"/>
		<result property="product_pic" column="product_pic"/>
		<association property="book" javaType="com.yulin.dangdang.bean.Book">
			<id property="id" column="id"/>
			<result property="author" column="author"/>
			<result property="publishing" column="publishing"/>
			<result property="publish_time" column="publish_time"/>
			<result property="word_number" column="word_number"/>
			<result property="which_edtion" column="which_edtion"/>
			<result property="total_page" column="total_page"/>
			<result property="print_time" column="print_time"/>
			<result property="print_number" column="print_number"/>
			<result property="isbn" column="isbn"/>
			<result property="author_summary" column="author_summary"/>
			<result property="catalogue" column="catalogue"/>
		</association>
	</resultMap>
	
	<!-- new.jsp -->
	<select id="findProductByTime" parameterType="map" resultMap="Book">
		select * from d_product p join d_book b on p.id=b.id order by publish_time desc limit 0,4;
	</select>
	<resultMap type="com.yulin.dangdang.bean.Product" id="Book">
		<id property="id" column="id"/>
		<result property="product_name" column="product_name"/>
		<result property="description" column="description"/>
		<result property="add_time" column="add_time"/>
		<result property="fixed_price" column="fixed_price"/>
		<result property="dang_price" column="dang_price"/>
		<result property="keywords" column="keywords"/>
		<result property="has_deleted" column="has_deleted"/>
		<result property="product_pic" column="product_pic"/>
		<result property="product_pic" column="product_pic"/>
		<association property="book" select="findProductId" column="id">
			<id property="id" column="id"/>
			<result property="author" column="author"/>
			<result property="publishing" column="publishing"/>
			<result property="publish_time" column="publish_time"/>
			<result property="word_number" column="word_number"/>
			<result property="which_edtion" column="which_edtion"/>
			<result property="total_page" column="total_page"/>
			<result property="print_time" column="print_time"/>
			<result property="print_number" column="print_number"/>
			<result property="isbn" column="isbn"/>
			<result property="author_summary" column="author_summary"/>
			<result property="catalogue" column="catalogue"/>
		</association>
	</resultMap>
	
	<!-- recommend -->
	<select id="findProductIn" parameterType="map" resultMap="Books">
		select * from d_product p join d_book b on p.id=b.id;
	</select>
	<resultMap type="com.yulin.dangdang.bean.Product" id="Books">
		<id property="id" column="id"/>
		<result property="product_name" column="product_name"/>
		<result property="description" column="description"/>
		<result property="add_time" column="add_time"/>
		<result property="fixed_price" column="fixed_price"/>
		<result property="dang_price" column="dang_price"/>
		<result property="keywords" column="keywords"/>
		<result property="has_deleted" column="has_deleted"/>
		<result property="product_pic" column="product_pic"/>
		<result property="product_pic" column="product_pic"/>
		<association property="book" select="findProductId" column="id">
			<id property="id" column="id"/>
			<result property="author" column="author"/>
			<result property="publishing" column="publishing"/>
			<result property="publish_time" column="publish_time"/>
			<result property="word_number" column="word_number"/>
			<result property="which_edtion" column="which_edtion"/>
			<result property="total_page" column="total_page"/>
			<result property="print_time" column="print_time"/>
			<result property="print_number" column="print_number"/>
			<result property="isbn" column="isbn"/>
			<result property="author_summary" column="author_summary"/>
			<result property="catalogue" column="catalogue"/>
		</association>
	</resultMap>
	
	<!-- 标题位置 -->
	<select id="findParentId" parameterType="int" resultType="com.yulin.dangdang.bean.Category">
		select name from d_category where id =(select parent_id from d_category where id = #{id})
	</select>
	
	<!-- 更多 -->
	<select id="findProductByTimeAll" parameterType="map" resultMap="BookNew">
		select * from d_product p join d_book b on p.id=b.id order by publish_time desc;
	</select>
	<resultMap type="com.yulin.dangdang.bean.Product" id="BookNew">
		<id property="id" column="id"/>
		<result property="product_name" column="product_name"/>
		<result property="description" column="description"/>
		<result property="add_time" column="add_time"/>
		<result property="fixed_price" column="fixed_price"/>
		<result property="dang_price" column="dang_price"/>
		<result property="keywords" column="keywords"/>
		<result property="has_deleted" column="has_deleted"/>
		<result property="product_pic" column="product_pic"/>
		<result property="product_pic" column="product_pic"/>
		<association property="book" select="findProductId" column="id">
			<id property="id" column="id"/>
			<result property="author" column="author"/>
			<result property="publishing" column="publishing"/>
			<result property="publish_time" column="publish_time"/>
			<result property="word_number" column="word_number"/>
			<result property="which_edtion" column="which_edtion"/>
			<result property="total_page" column="total_page"/>
			<result property="print_time" column="print_time"/>
			<result property="print_number" column="print_number"/>
			<result property="isbn" column="isbn"/>
			<result property="author_summary" column="author_summary"/>
			<result property="catalogue" column="catalogue"/>
		</association>
	</resultMap>
</mapper>